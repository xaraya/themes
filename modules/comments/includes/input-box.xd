<xar:comment> for this module specific css rules look at comments/xarstyles/comments.css file [andyv] </xar:comment>
<script type="text/javascript" src="modules/base/xartemplates/includes/submitonce.js"></script>
<xar:sec mask="Comments-Reply" catch="false">
  <h3>#$header['input-title']#</h3> 
  <form action="#$receipt['post_url']#" method="post" name="post" id="post" onSubmit="submitonce(this)" #$hooks['formaction']# >
    <div class="xar-ib-wrapper xar-accent-outline">
      <xar:if condition="$hooks['formdisplay'] ne ''">
        <div class="xar-ib-actionpanel xar-accent">
          <span>
            <xar:mlstring>
              BBCode Actions 
            </xar:mlstring>
            : 
          </span>
          <span>
            #$hooks['formdisplay']# 
          </span>
        </div>
        <div class="xar-ib-leftpanelshort">
          <p> 
            <xar:mlstring>
              Name 
            </xar:mlstring>
            : 
            <xar:if condition="strtolower(xarUserGetVar('uname')) ne 'anonymous'">
              <a href="&xar-modurl-roles-user-display;&amp;uid=#$package['uid']#"> #$package['name']# </a> 
              <xar:if condition="$receipt['action'] ne 'modify' and xarUserIsLoggedIn()">
                [ <a class="xar-norm" href="&xar-modurl-authsystem-user-logout;"> 
                  <xar:mlstring>
                    Logout 
                  </xar:mlstring>
                </a> ] 
              </xar:if>
              <xar:if condition="xarModGetVar('comments','AllowPostAsAnon') eq '1'">
                <xar:if condition="isset($package['postanon']) and $package['postanon'] eq '1'">
                  <input type="checkbox" name="package[postanon]" id="package-postanon" checked="checked" /> 
                <xar:else />
                  <input type="checkbox" name="package[postanon]" id="package-postanon" /> 
                </xar:if>
                <xar:mlstring>
                  Post anonymously 
                </xar:mlstring>
                <br />
              </xar:if>
            <xar:else />
              #$package['name']# 
            </xar:if>
          </p>
          <label for="package-title">
            <xar:mlstring>
              Title:
            </xar:mlstring>
          </label>
          <xar:if condition="isset($package['new_title'])">
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="#$package['new_title']#" tabindex="1" /> 
          <xar:elseif condition="!empty($package['title'])" />
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="#$package['title']#" tabindex="1" /> 
          <xar:else />
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="" tabindex="1" /> 
          </xar:if>        
          <label for="package-text">
            <xar:mlstring>
              Comment:
            </xar:mlstring>
          </label>
          <xar:if condition="isset($package['text'])">
            <textarea class="xar-ib-fieldtext" name="package[text]" id="package-text" tabindex="2">#$package['text']#</textarea>
          <xar:else />
            <textarea class="xar-ib-fieldtext" name="package[text]" id="package-text" tabindex="2"></textarea>
          </xar:if>
          <xar:comment> TODO: show item new/modify hook here somehow
            <xar:if condition="!empty($hooks['iteminput'])">
              <xar:foreach in="$hooks['iteminput']" key="$hookmodule">
                #$hooks.iteminput.$hookmodule#
              </xar:foreach>
            </xar:if>
          </xar:comment>
          <input type="hidden" name="header[modid]" id="header-modid" value="#$header['modid']#" /> 
          <input type="hidden" name="header[objectid]" id="header-objectid" value="#$header['objectid']#" /> 
          <input type="hidden" name="header[itemtype]" id="header-itemtype" value="#$header['itemtype']#" /> 
          <xar:if condition="!isset($header['pid']) or empty($header['pid'])">
            <input type="hidden" name="header[pid]" id="header-pid" value="0" /> 
          <xar:else />
            <input type="hidden" name="header[pid]" id="header-pid" value="#$header['pid']#" /> 
          </xar:if>
          <xar:if condition="isset($receipt['action']) and $receipt['action'] eq 'modify'">
            <input type="hidden" name="header[cid]" id="header-cid" value="#$header['cid']#" /> 
          </xar:if>
          <input type="hidden" name="receipt[returnurl][decoded]" id="receipt-returnurl-decoded" value="#$receipt['returnurl']['decoded']#" />
          <!--<input type="hidden" name="receipt[returnurl][encoded]" id="receipt-returnurl-encoded" value="#$receipt['returnurl']['encoded']#" />-->
          <input type="hidden" name="receipt[action]" id="receipt-action" /> 
          <input type="submit" id="receipt-action-preview" onclick="document.getElementById('receipt-action').value='preview'" value="#xarML('Preview')#" /> 
          <input type="submit" id="receipt-action-submit" onclick="document.getElementById('receipt-action').value='submit'" value="#xarML('Submit')#" />
        </div>
      <xar:else/>
        <div class="xar-ib-leftpanel">
          <p> 
            <xar:mlstring>
              Name 
            </xar:mlstring>
            : 
            <xar:if condition="strtolower(xarUserGetVar('uname')) ne 'anonymous'">
              <a href="&xar-modurl-roles-user-display;&amp;uid=#$package['uid']#"> #$package['name']# </a> 
              <xar:if condition="$receipt['action'] ne 'modify' and xarUserIsLoggedIn()">
                [ <a class="xar-norm" href="&xar-modurl-authsystem-user-logout;"> 
                  <xar:mlstring>
                    Logout 
                  </xar:mlstring>
                </a> ] 
              </xar:if>
              <xar:if condition="xarModGetVar('comments','AllowPostAsAnon') eq '1'">
                <xar:if condition="isset($package['postanon']) and $package['postanon'] eq '1'">
                  <input type="checkbox" name="package[postanon]" id="package-postanon" checked="checked" /> 
                <xar:else />
                  <input type="checkbox" name="package[postanon]" id="package-postanon" /> 
                </xar:if>
                <xar:mlstring>
                  Post anonymously 
                </xar:mlstring>
                <br />
              </xar:if>
            <xar:else />
              #$package['name']# 
            </xar:if>
          </p>
          <label for="package-title">
            <xar:mlstring>
              Title:
            </xar:mlstring>
          </label>
          <xar:if condition="isset($package['new_title'])">
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="#$package['new_title']#" tabindex="1" /> 
          <xar:elseif condition="!empty($package['title'])" />
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="#$package['title']#" tabindex="1" /> 
          <xar:else />
            <input class="xar-ib-field" type="text" name="package[title]" id="package-title" value="" tabindex="1" /> 
          </xar:if>        
          <label for="package-text">
            <xar:mlstring>
              Comment:
            </xar:mlstring>
          </label>
          <xar:if condition="isset($package['text'])">
            <textarea class="xar-ib-fieldtext" name="package[text]" id="package-text" tabindex="2">#$package['text']#</textarea>
          <xar:else />
            <textarea class="xar-ib-fieldtext" name="package[text]" id="package-text" tabindex="2"></textarea>
          </xar:if>
          <xar:comment> TODO: show item new/modify hook here somehow
            <xar:if condition="!empty($hooks['iteminput'])">
              <xar:foreach in="$hooks['iteminput']" key="$hookmodule">
                #$hooks.iteminput.$hookmodule#
              </xar:foreach>
            </xar:if>
          </xar:comment>
          <input type="hidden" name="header[modid]" id="header-modid" value="#$header['modid']#" /> 
          <input type="hidden" name="header[objectid]" id="header-objectid" value="#$header['objectid']#" /> 
          <input type="hidden" name="header[itemtype]" id="header-itemtype" value="#$header['itemtype']#" /> 
          <xar:if condition="!isset($header['pid']) or empty($header['pid'])">
            <input type="hidden" name="header[pid]" id="header-pid" value="0" /> 
          <xar:else />
            <input type="hidden" name="header[pid]" id="header-pid" value="#$header['pid']#" /> 
          </xar:if>
          <xar:if condition="isset($receipt['action']) and $receipt['action'] eq 'modify'">
            <input type="hidden" name="header[cid]" id="header-cid" value="#$header['cid']#" /> 
          </xar:if>
          <input type="hidden" name="receipt[returnurl][decoded]" id="receipt-returnurl-decoded" value="#$receipt['returnurl']['decoded']#" /> 
          <!--<input type="hidden" name="receipt[returnurl][encoded]" id="receipt-returnurl-encoded" value="#$receipt['returnurl']['encoded']#" />-->
          <input type="hidden" name="receipt[action]" id="receipt-action"/> 
          <input type="submit" id="receipt-action-preview" onclick="document.getElementById('receipt-action').value='preview'" value="#xarML('Preview')#" /> 
          <input type="submit" id="receipt-action-submit" onclick="document.getElementById('receipt-action').value='submit'" value="#xarML('Submit')#" />
        </div>
      </xar:if>
    </div>
  </form>
</xar:sec>
